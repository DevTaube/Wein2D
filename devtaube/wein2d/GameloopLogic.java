package devtaube.wein2d;

class GameloopThread extends Thread
{
    // Variables ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    private final Gameloop gameloopObject;
    protected int fps = 60;
    private boolean running;
    // Constructor ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    GameloopThread(Gameloop gameloop) {
        this.gameloopObject = gameloop;
    }
    // Start ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    public void run()
    {
        running = true;
        gameloop();
    }
    // Gameloop ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    private void gameloop()
    {
        long frameStartTime;
        long frameTime;
        long waitTime;
        while (running)
        {
            // get Time at start of Frame
            frameStartTime = System.currentTimeMillis();
            // call methods
            synchronized(gameloopObject)
            {
                gameloopObject.onFrame();
            }
            // calculate amount of sleep
            frameTime = System.currentTimeMillis() - frameStartTime;
            waitTime = 1000 / fps - frameTime;
            // sleep
            if(waitTime > 0)
            {
                try {
                    Thread.sleep(waitTime);
                } catch (Exception e) { e.printStackTrace(); }
            }
        }
    }
}
